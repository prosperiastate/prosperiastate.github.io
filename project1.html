<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
    <title>Project 1: Bridge Crack Inspection</title>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.5/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@0.7.5/dist/leaflet.js"></script>

    <style>
      body { margin:0; padding:0; }
      body, table, tr, td, th, div, h1, h2, input {
        font-family: "Calibri", "Trebuchet MS", "Ubuntu", Serif;
        font-size: 11pt;
      }

      /* Full-width top title bar */
      #topTitle {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 50px;
        background-color: #C8102E;
        color: white;
        display: flex;               /* use flexbox */
        align-items: center;         /* vertical center */
        justify-content: center;     /* center content */
        font-size: 18pt;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        padding: 0 10px;
        overflow: hidden;
        text-align: center;
      }

      #topTitle a {
        color: white;
        text-decoration: none;
        font-weight: bold;
        margin-right: 20px;
        flex-shrink: 0;
        white-space: nowrap;
      }

      #topTitle span.titleText {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;   /* show "..." if too long */
        flex-shrink: 1;
      }

      @media (max-width: 400px) {
        #topTitle {
          font-size: 14pt;
        }
      }

      /* Map fills remaining space below title */
      #map { position:absolute; top:50px; bottom:0; width:100%; }

      .ctl {
        padding: 2px 10px 2px 10px;
        background: rgba(255,255,255,0.9);
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 5px;
        text-align: right;
      }

      .src { font-size: 10pt; }
    </style>
  </head>
  <body>

    <!-- Full-width top title -->
    <div id="topTitle">
      <a href="https://prosperiastate.github.io/">Home</a>
      <span class="titleText">Project 1: Bridge Crack Inspection</span>
    </div>

    <!-- Map -->
    <div id="map"></div>

    <script>
      // Base layers
      var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors', minZoom: 17, maxZoom: 26});

      var white = L.tileLayer(
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAQMAAABmvDolAAAAA1BMVEX///+nxBvIAAAAH0lEQVQYGe3BAQ0AAADCIPunfg43YAAAAAAAAAAA5wIhAAAB9aK9BAAAAABJRU5ErkJggg==",
        {minZoom: 17, maxZoom: 26}
      );

      var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
          maxZoom: 26,
          subdomains:['mt0','mt1','mt2','mt3'],
          attribution: 'Map data Â© Google'
      });

      // Overlays
      var lyr  = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_1_Bridge_Crack/Humboldt_15ft/{z}/{x}/{y}.png',
        {tms: 1, attribution: "", minZoom: 17, maxZoom: 26});
      var bounds1 = [[42.8588797, -94.2271783], [42.8593420, -94.2273665]];

      var lyr2 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_1_Bridge_Crack/Humboldt_40ft/{z}/{x}/{y}.png',
        {tms: 1, attribution: "", minZoom: 17, maxZoom: 26});

      var lyr3 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_1_Bridge_Crack/NEMM_part1_15ft/{z}/{x}/{y}.png',
        {tms: 1, attribution: "", minZoom: 17, maxZoom: 26});

      var lyr4 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_1_Bridge_Crack/NEMM_part2_15ft/{z}/{x}/{y}.png',
        {tms: 1, attribution: "", minZoom: 17, maxZoom: 26});

      var lyr5 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_1_Bridge_Crack/NEMM_part3_15ft/{z}/{x}/{y}.png',
        {tms: 1, attribution: "", minZoom: 17, maxZoom: 26});
      var bounds3 = [[41.6502, -93.5792], [41.6507, -93.5797]];

      // Initialize map
      var map = L.map('map', {
        center: [42.85911, -94.22727],
        zoom: 17,
        minZoom: 17,
        maxZoom: 26,
        layers: [osm, lyr]
      });



      // Layers control
      var basemaps = { 
        "Open Street Map": osm, 
        "Google": googleSat, 
        "Without background": white 
      };
      var overlaymaps = { 
        "Humboldt (15ft)": lyr,
        "Humboldt (40ft)": lyr2,
        "NEMM (15ft) Part 1": lyr3,
        "NEMM (15ft) Part 2": lyr4,
        "NEMM (15ft) Part 3": lyr5
      };
      L.control.layers(basemaps, overlaymaps, {collapsed: true}).addTo(map);
      L.control.scale({position: 'bottomleft'}).addTo(map);

      // Bounds mapping
      var overlayBounds = {
        [lyr._leaflet_id]: bounds1,
        [lyr2._leaflet_id]: bounds1,
        [lyr3._leaflet_id]: bounds3,
        [lyr4._leaflet_id]: bounds3,
        [lyr5._leaflet_id]: bounds3
      };

      // Track current bounds
      var currentBounds = bounds1;

      // Fit bounds only when switching to a new bounding box
      map.on('overlayadd', function(e) {
        var newBounds = overlayBounds[e.layer._leaflet_id];
        if (newBounds && newBounds !== currentBounds) {
          map.fitBounds(newBounds);
          currentBounds = newBounds;
        }
      });

      // Bottom-left note
      var src = 'Hosted by ISU PROSPER Team';
      var note = L.control({position: 'bottomleft'});
      note.onAdd = function(map) {
        this._div = L.DomUtil.create('div', 'ctl src');
        this.update();
        return this._div;
      };
      note.update = function(props) {
        this._div.innerHTML = src;
      };
      note.addTo(map);

      // Initial fit
      map.fitBounds(bounds1);
    </script>
  </body>
</html>
