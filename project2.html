<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <title>Project 2: Gravel Road Inspection</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.5/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@0.7.5/dist/leaflet.js"></script>

  <style>
    body { margin:0; padding:0; }
    body, table, tr, td, th, div, h1, h2, input {
      font-family: "Calibri", "Trebuchet MS", "Ubuntu", Serif;
      font-size: 11pt;
    }

    /* Full-width top title bar */
    #topTitle {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 50px;
      background-color: #C8102E;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18pt;
      font-weight: bold;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      padding: 0 10px;
      overflow: hidden;
      text-align: center;
    }

    #topTitle a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      margin-right: 20px;
      flex-shrink: 0;
      white-space: nowrap;
    }

    #topTitle span.titleText {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 1;
    }

    @media (max-width: 400px) {
      #topTitle { font-size: 14pt; }
    }

    /* Map fills remaining space below title */
    #map { position:absolute; top:50px; bottom:0; width:100%; }

    .ctl {
      padding: 2px 10px;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 5px;
      text-align: right;
    }

    .src { font-size: 10pt; }
  </style>
</head>
<body>

  <!-- Full-width top title -->
  <div id="topTitle">
    <a href="https://prosperiastate.github.io/">Home</a>
    <span class="titleText">Project 2: Gravel Road Inspection</span>
  </div>

  <!-- Map -->
  <div id="map"></div>

  <script>
    // ==========================
    // Base Layers
    // ==========================
    var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors', minZoom: 17, maxZoom: 26});

    var white = L.tileLayer(
      "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAQMAAABmvDolAAAAA1BMVEX///+nxBvIAAAAH0lEQVQYGe3BAQ0AAADCIPunfg43YAAAAAAAAAAA5wIhAAAB9aK9BAAAAABJRU5ErkJggg==",
      {minZoom: 17, maxZoom: 26}
    );

    var googleSat = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
      maxZoom: 26,
      subdomains:['mt0','mt1','mt2','mt3'],
      attribution: 'Map data Â© Google'
    });

    var basemaps = {
      "Open Street Map": osm,
      "Google": googleSat,
      "Without background": white
    };

    // ==========================
    // Overlay Layers
    // ==========================
    // 150 street
    var RGB_150_40 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_2_Gravel_Road/150_40_RGB/{z}/{x}/{y}.png', {tms:1, minZoom:17, maxZoom:26});
    var Hillshade_150_40 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_2_Gravel_Road/150_40_Hillshade/{z}/{x}/{y}.png', {tms:1, minZoom:17, maxZoom:26});
    var RGB_150_60 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_2_Gravel_Road/150_60_RGB/{z}/{x}/{y}.png', {tms:1, minZoom:17, maxZoom:26});
    var Hillshade_150_60 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_2_Gravel_Road/150_60_Hillshade/{z}/{x}/{y}.png', {tms:1, minZoom:17, maxZoom:26});
    var st_150 = [[42.5694792739214, -91.95873130745527], [42.56964739785711, -91.96180111272622]];

    // 130 street
    var RGB_130_40 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_2_Gravel_Road/130_40_RGB/{z}/{x}/{y}.png', {tms:1, minZoom:17, maxZoom:26});
    var Hillshade_130_40 = L.tileLayer('https://pub-256928d690cc446c84032baa7343824c.r2.dev/Project_2_Gravel_Road/130_40_Hillshade/{z}/{x}/{y}.png', {tms:1, minZoom:17, maxZoom:26});
    var st_130 = [[42.59906257177964, -91.94123490802336], [42.59914213968349, -91.94212453535336]];

    var overlaymaps = {
      "150 st RGB (40ft)": RGB_150_40,
      "150 st Hillshade (40ft)": Hillshade_150_40,
      "150 st RGB (60ft)": RGB_150_60,
      "150 st Hillshade (60ft)": Hillshade_150_60,
      "130 st RGB (40ft)": RGB_130_40,
      "130 st Hillshade (40ft)": Hillshade_130_40
    };

    // ==========================
    // Initialize Map
    // ==========================
    var map = L.map('map', {
      center: [42.56956333588926, -91.96026621009074],
      zoom: 19,
      minZoom: 17,
      maxZoom: 26,
      layers: [osm, RGB_150_40] // Default base + overlay
    });

    // Create toggle button at TOP-LEFT
    var toggleButton = L.control({position: 'topright'});
    toggleButton.onAdd = function(map) {
      var div = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
      var link = L.DomUtil.create('a', '', div);
      link.innerHTML = '_';  // menu icon
      link.href = '#';
      link.title = 'Toggle layer list';

      L.DomEvent.on(link, 'click', function(e) {
        L.DomEvent.stop(e);
        var control = document.querySelector('.leaflet-control-layers');
        if (control.style.display === 'none') {
          control.style.display = 'block';
        } else {
          control.style.display = 'none';
        }
      });

      return div;
    };
    toggleButton.addTo(map);

    L.control.layers(basemaps, overlaymaps, {collapsed:false}).addTo(map);
    L.control.scale({position: 'bottomleft'}).addTo(map);
    // ==========================
    // Fit Bounds Logic
    // ==========================
    var overlayBounds = new Map([
      [RGB_150_40, st_150],
      [Hillshade_150_40, st_150],
      [RGB_150_60, st_150],
      [Hillshade_150_60, st_150],
      [RGB_130_40, st_130],
      [Hillshade_130_40, st_130]
    ]);

    var currentBounds = st_150; // initial

    map.on('overlayadd', function(e) {
      var newBounds = overlayBounds.get(e.layer);
      if (newBounds && newBounds !== currentBounds) {
        map.fitBounds(newBounds);
        currentBounds = newBounds;
      }
    });


    // ==========================
    // Bottom-left note
    // ==========================
    var src = 'Hosted by ISU PROSPER Team';
    var note = L.control({position: 'bottomleft'});
    note.onAdd = function(map) {
      this._div = L.DomUtil.create('div', 'ctl src');
      this.update();
      return this._div;
    };
    note.update = function() { this._div.innerHTML = src; };
    note.addTo(map);
  </script>

</body>
</html>
